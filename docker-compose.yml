version: '2'

#networks:
#    default:
#        external:
#             name: local_net

services:
    # traefik for docker containers management
    traefik:
        image: traefik:1.5
        command: --web --docker --logLevel=DEBUG
        ports:
            - "80:80"
            - "8080:8080"
            - "8090:8090"
        volumes:
            - "/var/run/docker.sock:/var/run/docker.sock"
            - "$PWD/traefik.toml:/traefik.toml"

    jeedom:
        container_name: jeedom
        build : ./
        labels:
            - "traefik.http.routers.api.rule=Host(`traefik.nico.si`)"
            - "traefik.http.routers.api.service=api@internal"
            - "traefik.http.routers.api.entrypoints=http"
            - "traefik.http.routers.api.middlewares=auth"
            - "traefik.http.middlewares.auth.basicauth.users=${HTPASSWD}"

        privileged: false
        pid: "host"
        cap_add:
             - SYS_PTRACE
        # tty: true
        hostname: jeedom
        #mac_address: a0:ca:ab:cd:ef:02
        #networks:
        #     default:
        #        ipv4_address: 192.168.1.11
        # devices:
        #     - "/dev/ttyUSB0"
        #     - "/dev/ttyUSB1"
        #     - "/dev/ttyACM0"
        restart: unless-stopped
        ports:
            - "80:80"

    db:
        container_name: db
        image: ghcr.io/linuxserver/mariadb
        restart: unless-stopped
        env_file:
            - ./.env

    adminer:
        container_name: adminer
        image: adminer
        ports:
            - "8090:8080"
