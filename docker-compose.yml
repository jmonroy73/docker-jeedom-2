version: '2'

networks:
    default:
        external:
             name: mymacvlan

services:
  # traefik for docker containers management
  traefik:
    image: traefik:1.5
    command: --web --docker --logLevel=DEBUG
    ports:
      - "80:80"
      - "8080:8080"
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock"
      - "$PWD/traefik.toml:/traefik.toml"

    jeedom:
        container_name: jeedom1
        build : ./
        labels:
            - "traefik.http.routers.api.rule=Host(`traefik.nico.si`)"
            - "traefik.http.routers.api.service=api@internal"
            - "traefik.http.routers.api.entrypoints=http"
            - "traefik.http.routers.api.middlewares=auth"
            - "traefik.http.middlewares.auth.basicauth.users=${HTPASSWD}"

        privileged: false
        pid: "host"
        cap_add:
             - SYS_PTRACE
        # tty: true
        hostname: jeedom
        mac_address: a0:ca:ab:cd:ef:02
        networks:
             default:
                ipv4_address: 192.168.1.243
        volumes:
             - "~/Documents/jeedom_core/core/:/var/www/html"
        # devices:
        #     - "/dev/ttyUSB0"
        #     - "/dev/ttyUSB1"
        #     - "/dev/ttyACM0"
        restart: unless-stopped
        environment:
             - TZ=Europe/Paris
             - PUID=1000
             - PGID=1000
             - SYSTEMD_IGNORE_CHROOT=yes
             - SHELL_ROOT_PASSWORD=password
             - MYSQL_ROOT_PASSWD=mysql-password
             - PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin